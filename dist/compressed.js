var _this=this;const bgMusic=()=>{const a=new AudioContext,b=80,c=new TinyMusic.Sequence(a,b,['G4 s','A4 s','B4 s','C5 s','D5 s','B4 s','C5 s','A4 s','B4 s','G4 s','A4 s','F4 s','D4 e','E4 s','F4 s','F4 s','G4 s','A4 s','B4 s','C5 s','A4 s','B4 s','G4 s','A4 s','F4 s','G4 s','E4 s','C4 e','D4 s','E4 q','A4 s','B4 s','C#5 s','D5 s','E5 s','F5 s','G5 s','G#5 s','A5 s','F5 s','- s','D5 s','A4 e','A#4 e','B4 e','G5 e','- e','F5 e','F5 s','E5 e','D#5 s','E5 s']),d=new TinyMusic.Sequence(a,b,['- s','- s','- s','C3 es','E3 s','G3 e','C3 e','D3 es','D3 s','B3 e','D3 e','G2 es','D3 s','B3 e','B2 e','C3 es','E3 s','G3 q','C#3 es','E3 s','G3 e','C#3 e','D3 es','F3 s','A3 e','- e','G2 es','D3 s','F3 e','G2 e','C3 es','E3 s','G3 s']);return c.staccato=0.4,d.staccato=0.4,c.gain.gain.value=0.3,d.gain.gain.value=0.3,c.mid.frequency.value=800,c.mid.gain.value=3,d.bass.gain.value=6,d.bass.frequency.value=80,d.mid.gain.value=-6,d.mid.frequency.value=500,d.treble.gain.value=-2,d.treble.frequency.value=1400,c.loop=!0,d.loop=!0,[c,d]},gameEnd=()=>{const a=new AudioContext,b=80,c=new TinyMusic.Sequence(a,b,['C5 e','D5 e','C5 e','B4 e','C5 h']),d=new TinyMusic.Sequence(a,b,['G2 e','D3 e','F3 e','G2 e','E2 e','G3 e','C2 q']);return c.staccato=0.4,d.staccato=0.4,c.gain.gain.value=0.3,d.gain.gain.value=0.3,c.mid.frequency.value=800,c.mid.gain.value=3,d.bass.gain.value=6,d.bass.frequency.value=80,d.mid.gain.value=-6,d.mid.frequency.value=500,d.treble.gain.value=-2,d.treble.frequency.value=1400,c.loop=!1,d.loop=!1,[c,d]},musicPlay=(a)=>{a.map((a)=>{a.play()})},musicStop=(a)=>{a.map((a)=>{a.stop()})},cSound=()=>{const a=new AudioContext,b=new TinyMusic.Sequence(a,80,['C5 0.1','D5 0.1']);return b.createCustomWave([-1,0,1,0,-1,0,1],[1,0,-1,0,1,0,-1]),b.loop=!1,[b]},tSound=()=>{const a=new AudioContext,b=new TinyMusic.Sequence(a,120,['C4 0.2','Eb4 0.2','C4 0.2','Eb4 0.2','C4 0.2','Eb4 0.2']);return b.createCustomWave([-1,1,1,1,-1,1,1],[1,1,-1,1,1,1,-1]),b.smoothing=0.5,b.loop=!1,[b]},cocoSound=()=>{const a=new AudioContext,b=new TinyMusic.Sequence(a,80,['- 0.9','G3 0.1','- 0.3','G3 0.1']);return b.createCustomWave([-1,1,1,1,-1,1,1],[1,1,-1,1,1,1,-1]),b.staccato=0.3,b.loop=!1,[b]},music=bgMusic(),crabSound=cSound(),treeSound=tSound(),coconutSound=cocoSound(),endMusic=gameEnd(),color='#ee7600',zero=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'3',depth:'1',color:color,position:'1 2 0'})(c),cEle('a-box',{width:'1',height:'3',depth:'1',color:color,position:'-1 2 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(c),c},one=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'0 2 0'})(c),c},two=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'1 3 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'-1 1 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(c),c},three=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'1 3 0'})(c),cEle('a-box',{width:'2',height:'1',depth:'1',color:color,position:'0.5 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'1 1 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(c),c},four=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'1',height:'2',depth:'1',color:color,position:'-1 3.5 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(c),c},five=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'-1 3 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'1 1 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(c),c},six=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 0 0'})(c),cEle('a-box',{width:'1',height:'3',depth:'1',color:color,position:'1 1 0'})(c),c},seven=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(c),c},eight=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 0 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(c),c},nine=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0',class:'number'})(a);return cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'-1 3 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(c),c},scoreMap={0:zero.bind(this),1:one.bind(this),2:two.bind(this),3:three.bind(this),4:four.bind(this),5:five.bind(this),6:six.bind(this),7:seven.bind(this),8:eight.bind(this),9:nine.bind(this)},s=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0'})(a);cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'-1 3 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'1 1 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(c)},t=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0'})(a);cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'0 2 0'})(c)},a=(a)=>{const b=cEle('a-entity',{position:'0 0 0'})(a);cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(b),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(b),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(b)},r=(a,b)=>{const c=cEle('a-entity',{position:b+' 0 0'})(a);cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(c),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(c),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'1 3 0'})(c),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(c),cEle('a-box',{width:'1',height:'3',depth:'1',color:color,position:'0.5 0.8 0',rotation:'0 0 45'})(c)},h=(a)=>{const b=cEle('a-entity',{position:'-20 0 0'})(a);cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(b),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(b),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 2 0'})(b)},i=(a)=>{const b=cEle('a-entity',{position:'-16 0 0'})(a);cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'0 2 0'})(b)},c=(a)=>{const b=cEle('a-entity',{position:'-4 0 0'})(a);cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(b)},o=(a)=>{const b=cEle('a-entity',{position:'0 0 0'})(a);cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(b),cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'1 2 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(b)},e=(a)=>{const b=cEle('a-entity',{position:'8 0 0'})(a);cEle('a-box',{width:'1',height:'5',depth:'1',color:color,position:'-1 2 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 4 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 2 0'})(b),cEle('a-box',{width:'3',height:'1',depth:'1',color:color,position:'0 0 0'})(b)},col=(a)=>{const b=cEle('a-entity',{position:'12 0 0'})(a);cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 3 0'})(b),cEle('a-box',{width:'1',height:'1',depth:'1',color:color,position:'0 1 0'})(b)},scene=document.querySelector('a-scene'),scoreBoard=document.getElementById('score'),cEle=(a,b)=>{const c=document.createElement(a);return Object.entries(b).map((a)=>c.setAttribute(a[0],a[1])),(a)=>(a.append(c),c)};cEle('a-sky',{color:'#ccccff'})(scene);const cam=cEle('a-entity',{camera:!0,id:'camera',position:'0 5 16',target:'#island',"orbit-controls":!0,distance:'16'})(scene);cEle('a-light',{type:'point',color:'#ffffaa',position:'5 5 5'})(cam),AFRAME.utils.device.isMobile()&&(cEle('a-entity',{cursor:'fuse: false;',position:'0 0 -2',geometry:'primitive: ring; radiusInner: 0.02; radiusOuter: 0.03',material:'color: #333333; shader: flat'})(cam),cam.object3D.el.attributes.distance.value=20);const island=cEle('a-icosahedron',{material:'flatShading: true; color: #77ff77;',radius:'10',detail:'2',position:'0 0 0',rotation:'-90 90 0',scale:'1 1 0.3',id:'island'})(scene),beach=cEle('a-icosahedron',{material:'flatShading: true; color: #ffffdd;',radius:'10',detail:'1',position:'0 0 0',rotation:'-90 90 0',scale:'1.3 1.3 0.1',id:'beach'})(scene),ocean=cEle('a-icosahedron',{material:'flatShading: true; color: #3399cc;',radius:'50',detail:'2',position:'0 -4.5 0',rotation:'-90 90 0',scale:'1 1 0.1',id:'ocean'})(scene),oceanTides=cEle('a-animation',{attribute:'position',from:'0 -4.5 0',to:'0 -4.4 0',direction:'alternate',dur:'10000',repeat:'indefinite'})(ocean),trunk=cEle('a-torus',{material:'flatShading: true; color: #999955; side: double;',radius:'10',"radius-tubular":'0.2',"segments-radial":'8',"segments-tubular":'4',position:'-10 1 0',arc:'40',id:'trunk'})(scene),leaves=cEle('a-entity',{position:'-2.5 7.6 0',rotation:'0 0 30'})(scene),generateLeaves=(a)=>{if(360>a){const b=cEle('a-entity',{position:'0 0 0',rotation:'0 '+a+' -20'})(leaves);return cEle('a-octahedron',{material:'flatShading: true; color: #77ff77;',radius:'1',position:'2 0 0',scale:'2 0.2 1'})(b),generateLeaves(a+60)}};generateLeaves(0);const coconut=cEle('a-icosahedron',{material:'flatShading: true; color: #555522;',radius:'0.6',detail:'1',position:'-2 6.9 0.75',id:'coconut'})(scene),hideCrab=(a)=>{musicPlay(crabSound),cEle('a-animation',{attribute:'position',to:'0 -24 0',easing:'ease-in-out',dur:'400'})(a),setTimeout(()=>{null!==a.parentNode&&a.parentNode.removeChild(a)},500)},createCrab=(a,b)=>{const c=cEle('a-entity',{position:'0 -23 0',rotation:'0 '+a+' -30',class:'crabRotator'})(scene),d=cEle('a-animation',{attribute:'rotation',dur:b,fill:'forwards',easing:'ease-out',from:'0 '+a+' -30',to:'0 '+a+' 0'})(c),e=cEle('a-entity',{position:'0 26.2 0',rotation:'0 -60 0',class:'crabby'})(c),f=cEle('a-animation',{attribute:'rotation',dur:'200',from:'0 -60 0',to:'0 -80 0',direction:'alternate',repeat:'indefinite'})(e),g=cEle('a-icosahedron',{material:'flatShading: true; color: #dd0000;',radius:'0.5',detail:'0',position:'0 0 0',scale:'1 0.3 1'})(e),h=(a)=>{if(220>a){const b=cEle('a-entity',{position:'0 0 0',rotation:'0 '+a+' -10'})(e);return cEle('a-cylinder',{material:'flatShading: true; color: #dd0000;',radius:'0.1',position:'0.5 0 0',scale:'3 0.1 1'})(b),h(a+300/8)}};return h(-60),cEle('a-sphere',{material:'flatShading: true; color: #dd0000; side: double;',radius:'0.3',"segments-height":'4',"segments-width":'10',"phi-length":'300',position:'-0.7 -0.1 0.4',rotation:'0 90 0',scale:'1 0.3 1'})(e),cEle('a-sphere',{material:'flatShading: true; color: #dd0000; side: double;',radius:'0.3',"segments-height":'4',"segments-width":'10',"phi-length":'300',position:'0.3 -0.1 0.7',rotation:'0 130 0',scale:'1 0.3 1'})(e),e.addEventListener('click',()=>{hideCrab(c),score++,processScore(score)}),c},info_button=document.getElementById('info'),info_popup=document.getElementById('info_popup'),infoButtonClick=()=>{info_popup.className=info_popup.classList.contains('hide')?'show':'hide'};info_button.addEventListener('click',infoButtonClick);const showHiScore=(a)=>{const b=cEle('a-entity',{position:'0 0.7 10',id:'hiScore',scale:'0.2 0.2 0.2'})(scene);h(b),i(b),s(b,-8),c(b),o(b),r(b,4),e(b),col(b);const d=Array.from(a.toString(10));return d.map((a,c)=>{scoreMap[a].call(_this,b,16+4*c)}),b},showStartText=()=>{const b=cEle('a-entity',{position:'0 3 3',id:'startText',scale:'0.5 0.5 0.5'})(scene);s(b,-8),t(b,-4),a(b),r(b,4),t(b,8),b.addEventListener('click',()=>{cEle('a-animation',{attribute:'position',from:'0 3 3',to:'0 -1 3',easing:'ease-in',dur:'1000'})(b),setTimeout(()=>{b.parentNode.removeChild(b)},1500),cEle('a-animation',{attribute:'position',from:'0 0.7 10',to:'0 -2 10',easing:'ease-in',dur:'1000'})(hiScore),setTimeout(()=>{hiScore.parentNode.removeChild(hiScore)},1500),startGame()})};let start,lastPosition,lost,interval,speed,crabs,hiscore,score=0;const rotateScore=()=>{0>cam.object3D.position.z&&0<lastPosition?(cEle('a-animation',{attribute:'rotation',from:'0 0 0',to:'0 180 0',dur:'500',id:'scoreRotator'})(scores),lastPosition=cam.object3D.position.z):0<cam.object3D.position.z&&0>lastPosition&&(cEle('a-animation',{attribute:'rotation',from:'0 180 0',to:'0 0 0',dur:'500',id:'scoreRotator'})(scores),lastPosition=cam.object3D.position.z)},checkForLose=()=>{crabs.map((a)=>{-0.02<a.object3D.rotation.z&&(lost=!0)})},loseScreen=()=>{cEle('a-animation',{attribute:'rotation',from:'0 0 30',to:'-5 5 30',direction:'alternate',easing:'ease-in-out',dur:'100',repeat:'5'})(leaves),musicPlay(treeSound),cEle('a-animation',{attribute:'position',from:'-2 6.9 0.75',to:'-2 3.2 0.75',duration:'400',delay:'200',easing:'ease-out-bounce'})(coconut),musicPlay(coconutSound),setTimeout(()=>{musicStop(music),musicPlay(endMusic)},200),setTimeout(()=>{crabs.map((a)=>{const b=document.createRange();b.selectNodeContents(a),b.deleteContents()}),cEle('a-animation',{attribute:'position',to:'-2 6.9 0.75',from:'-2 3.2 0.75',duration:'400',easing:'ease-out'})(coconut),0>cam.object3D.position.z&&cEle('a-animation',{attribute:'rotation',from:'0 180 0',to:'0 0 0',dur:'500',id:'scoreRotator'})(scores),score>hiscore&&(localStorage.setItem('hiScore',score),hiscore=score)},2e3),setTimeout(()=>{showStartText(),showHiScore(hiscore)},2100)},runGame=(a)=>{var b=Math.round,c=Math.log;if(lost)return void loseScreen();if(checkForLose(),a-start>=interval){start=a,0!==score&&(1e3>=speed?speed=1e3:speed-=b(100*c(score)),1e3>=interval?interval=1e3:interval-=b(50*c(score)));const d=b(360*Math.random());crabs.push(createCrab(d,speed))}rotateScore(),requestAnimationFrame(runGame)},startGame=()=>{start=0,score=0,lastPosition=-13,lost=!1,interval=4e3,speed=2e4,crabs=[],processScore(score),musicPlay(music),requestAnimationFrame(runGame)};hiscore=localStorage.getItem('hiScore')||0,showStartText(),showHiScore(hiscore);const scores=cEle('a-entity',{position:'0 9 0',scale:'0.3 0.3 0.3'})(scene),processScore=(a)=>{if(void 0===a)return;const b=document.createRange();b.selectNodeContents(scores),b.deleteContents();const c=Array.from(a.toString(10));c.map((a,b)=>{const d=1<c.length?-2+4*b:0;scoreMap[a].call(_this,scores,d)})};processScore(score);